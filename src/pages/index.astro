---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Section from '../components/Section.astro';
import ProjectEntry from '../components/ProjectEntry.astro';
import Skills from '../components/Skills.astro';
import Education from '../components/Education.astro';

// Get profile from context (set by ProfileProvider in Layout)
const profile = Astro.locals.profile || await import('../data/profile.json').then(m => m.default);

// Normalize projects to ensure metrics are available in expected shape
const normalizedProjects = (profile.projects || []).map((p: any) => ({
  ...p,
  metrics: p.metrics ?? {
    scale: (p as any).scale,
    security: (p as any).security,
    performance: (p as any).performance,
    innovation: (p as any).innovation,
  },
}));
---

<Layout>
  <Header profile={profile} />

  <Section id="contact-info" title="Contact Info">
    <div class="terminal-contact">
      <div class="terminal-header">
        <span class="terminal-prompt">$ ./connect --list</span>
      </div>
      <div class="contact-terminal-output">
        <div class="contact-entry">
          <span class="contact-method">[EMAIL]</span>
          <span class="contact-separator">></span>
          <a href={`mailto:${profile.contact.email}`} class="contact-value">{profile.contact.email}</a>
        </div>
        {profile.personal?.website && (
          <div class="contact-entry">
            <span class="contact-method">[WEB]</span>
            <span class="contact-separator">></span>
            <a href={profile.personal.website} target="_blank" rel="noopener noreferrer" class="contact-value">{profile.personal.website}</a>
          </div>
        )}
        {profile.social?.linkedin && (
          <div class="contact-entry">
            <span class="contact-method">[LINKEDIN]</span>
            <span class="contact-separator">></span>
            <a href={profile.social.linkedin} target="_blank" rel="noopener noreferrer" class="contact-value">linkedin.com/in/alqattandev</a>
          </div>
        )}
        {profile.social?.github && (
          <div class="contact-entry">
            <span class="contact-method">[GITHUB]</span>
            <span class="contact-separator">></span>
            <a href={profile.social.github} target="_blank" rel="noopener noreferrer" class="contact-value">github.com/AlqattanDev</a>
          </div>
        )}
      </div>
      <div class="terminal-footer">
        <span class="terminal-cursor">â–ˆ</span>
      </div>
    </div>
  </Section>

  <Section id="project-manifest" title="Project Manifest">
    {normalizedProjects.map((project) => (
      <ProjectEntry project={project} />
    ))}
  </Section>

  <Section id="skill-matrix" title="Skill Matrix">
    <Skills skills={profile.skills} barStyle="terminal" animations={true} />
  </Section>

  <Section id="education-log" title="Education Log">
    <Education education={profile.education} />
  </Section>

  <div class="checksum">Checksum: {profile.checksum}</div>
  
</Layout>
